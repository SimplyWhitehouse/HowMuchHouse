<html>
	<head>
		<style>
			:root {
				--myBorderRadius: 0.3em;
			}
			
			.cntr {
				display: grid;
				grid-template-columns: 1fr auto 1fr;
				font-size: 1.3em;
				grid-row-gap: 3em;
			}

			.cntr div {
				grid-column: 2;
			}

			.inp {
				outline: none;
				margin: 0;
				font-size: 1em;
				text-align: right;
				border: none;
				width: 100%;
			}

			.userInput div {
				display: grid;
				grid-template-columns: auto auto;

				text-align: center;
				border-radius: var(--myBorderRadius);
				border-color: black;
				border-style: solid;
				border-width: 1px;
				padding: 3px;
				margin: 5px;
				background: white !important;
			}

			.userInput div span {
				color: #888;
			}

			.out {
				display: grid;
				grid-row-gap: 0.5em;
			}

			.out span {
				font-size: 1.2em;
			}

			.in {
				display: grid;
				grid-row-gap: 1.5em;
			}

		</style>
	</head>
	<body>
		<center class="cntr">
			<div class="in">
				<div class="userInput">
					Monthly Take Home Pay:
					<div class="money">
						<span>$</span>
						<input class="inp" value="3,000" id="in_takeHome"/>
					</div>
				</div>
				<div class="userInput">
					Money Saved Per Month:
					<div class="money">
						<span>$</span>
						<input class="inp" value="1,000" id="in_savedPerMonth"/>
					</div>
				</div>
				<div class="userInput">
					How Long Till You Buy:
					<div class="time">
						<span>Months</span>
						<input class="inp" value="12" id="in_waitDuration"/>
					</div>
				</div>
				<div class="userInput">
					Money Already Saved:
					<div class="money">
						<span>$</span>
						<input class="inp" value="0" id="in_alreadySaved"/>
					</div>
				</div>
				<div class="userInput">
					Annual Loan Rate:
					<div class="percent">
						<span>%</span>
						<input class="inp" value="3.75" id="in_annualLoanRate"/>
					</div>
				</div>
				<div class="userInput">
					Loan Duration:
					<div class="time">
						<span>Years</span>
						<input class="inp" value="15" id="in_loanDuration"/>
					</div>
				</div>
			</div>
			<div class="out">
				<div>You can afford a home that is worth <span id="out_worth">$0</span>.</div>
				<div>The down payment will be <span id="out_down">$0</span>.</div>
				<div>The loan will be <span id="out_loan">$0</span>.</div>
				<div>The payment will be <span id="out_payment">$0</span>.</div>
			</div>
		</center>
		<script>

const PRECENTDOWN = 0.2;

/** Grab the data from the user inputs
	RETURNS:
		Object - Contains all of the named values from the user input
*/
function getUserInfo(){
	const keys = [
		"takeHome",
		"savedPerMonth",
		"waitDuration",
		"alreadySaved",
		"annualLoanRate",
		"loanDuration"
	];

	let userInfo = {};

	for (key of keys){
		userInfo[key] = getValue("in_" + key);
	}

	userInfo.annualLoanRate = userInfo.annualLoanRate * 0.01;

	addDownPaymentToUserInfo(userInfo);

	return userInfo;
}

function getMaxPayment(userInfo){
	return userInfo.takeHome * 0.25;
}

/** 
	RETURNS:
		Object - contains loan amount, home worth, downpayment, and monthly payment
*/
function getLoanAndHomeByPercentDown(userInfo){
	let result = {};

	result.downPayment = userInfo.downPayment

	result.loan = result.downPayment / PRECENTDOWN;

	result.worth = result.downPayment + result.loan;

	const monthlyRate = userInfo.annualLoanRate/12;

	result.payment = monthlyRate*result.loan/(1-Math.pow(1+monthlyRate, -userInfo.loanDuration*12));

	return result;
}

/** 
	RETURNS:
		Object - contains loan amount, home worth, downpayment, and monthly payment
*/
function getLoanAndHomeByMaxPmt(userInfo){
	return {};
}

// mutate userInfo
function addDownPaymentToUserInfo(userInfo){
	userInfo.downPayment = userInfo.alreadySaved + userInfo.savedPerMonth * userInfo.waitDuration;
}

/** 
	RETURNS:
		Object - contains loan amount, home worth, downpayment, and monthly payment
*/
function getLoanAndHome(userInfo){
	let lnh = getLoanAndHomeByPercentDown(userInfo);
	const lnh_maxpmt = getLoanAndHomeByMaxPmt(userInfo);
	const maxPmt = getMaxPayment(userInfo);

	if (lnh.payment > maxPmt){
		lnh = lnh_maxpmt;
	}
	return lnh;
}

function findAndShowResults(userInfo){
	const lnh = getLoanAndHome(userInfo);

	setText("out_worth", 	lnh.worth);
	setText("out_down", 	lnh.down);
	setText("out_loan", 	lnh.loan);
	setText("out_payment", 	lnh.payment);
}


// Manipulate elements
function setText(id, str){
	document.getElementById(id).innerText = str;
}

function getValue(id){
	const str = document.getElementById(id).value.replace(",","");
	return parseFloat(str);
}

// Formatting
function formatToMoney(num){
	return num.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, '$1,');
}
function formatFromMoney(str){
	return Number(str.replace(/[^0-9\.-]+/g,""));
}
function formatMoneyElement(el){
	el.value = formatToMoney(formatFromMoney(el.value));
}
function formatToPercent(num){
	return num.toFixed(2);
}
function formatPercentElement(el){
	el.value = formatToPercent(Number(el.value));
}
let prevTO = 0;
function makeUpdateCallback(time){
	return () => {
		window.clearTimeout(prevTO);
		prevTO = window.setTimeout(updateResults, time || 0)
	};
}
const reformatMap = {
	"money": formatMoneyElement,
	"percent": formatPercentElement,
}
const queryForInputs = ".userInput div input";
function reformatInputs(){
	document.querySelectorAll(queryForInputs)
	.forEach(el => {
		if (reformatMap.hasOwnProperty(el.dataset.type)){
			reformatMap[el.dataset.type](el);
		}
	});
}
function addHandlersToInputs(){
	// Formatting the inputs after timeout or on blur
	document.querySelectorAll(queryForInputs)
	.forEach(el => {
		el.oninput = makeUpdateCallback(2000);
		el.onblur = makeUpdateCallback(0);
	});
}
addHandlersToInputs();

		</script>
	</body>
</html>